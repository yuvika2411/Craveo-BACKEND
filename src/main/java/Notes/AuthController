

# ğŸ“Œ Sabse Pehle â€“ Ye Controller Kya Kar Raha Hai?

```java
@RestController
@RequestMapping("/auth")
```

Iska matlab:

* Ye REST API controller hai
* Iske saare endpoints `/auth` se start honge
  ğŸ‘‰ `/auth/signup`
  ğŸ‘‰ `/auth/signin`

Ye pura class **authentication (login + signup)** handle kar raha hai.

---

# ğŸ” Dependencies Samjho (Why We Autowired These?)

### 1ï¸âƒ£ `UserRepository`

ğŸ‘‰ Database me user ko save karne aur find karne ke liye.

---

### 2ï¸âƒ£ `PasswordEncoder`

ğŸ‘‰ Password ko plain text me store nahi karte.
ğŸ‘‰ Encode (hash) karke store karte hain.

Example:

```
User types: 1234
Database stores: $2a$10$Hkskdkdjsd...
```

Security reason: Agar DB leak ho jaye toh password safe rahe.

---

### 3ï¸âƒ£ `JwtProvider`

ğŸ‘‰ Login ke baad JWT token generate karta hai.

JWT = proof that user authenticated hai.

---

### 4ï¸âƒ£ `CustomerUserDetailsService`

ğŸ‘‰ Spring Security ko batata hai user ka data kya hai.

Ye internally `loadUserByUsername()` call karta hai.

---

### 5ï¸âƒ£ `CartRepository`

ğŸ‘‰ Jab user signup karta hai tab uske liye empty cart create kar rahe ho.

Food app bana rahi ho na ğŸ•, isliye.

---

---

# ğŸŸ¢ SIGNUP FLOW (`/auth/signup`)

```java
@PostMapping("/signup")
```

## Step 1ï¸âƒ£ â€“ Check Email Already Exists?

```java
User isEmailExist= userRepository.findByEmail(user.getEmail());
if(isEmailExist!=null){
    throw new RuntimeException("Email already used.");
}
```

Why?
ğŸ‘‰ Ek hi email se multiple accounts nahi hone chahiye.

---

## Step 2ï¸âƒ£ â€“ Create New User Object

```java
User createdUser= new User();
```

Direct user ko save kyu nahi kiya?

ğŸ‘‰ Best practice: client se aaya hua object directly save nahi karte.
ğŸ‘‰ Naya object bana ke sirf required fields set karte hain.

---

## Step 3ï¸âƒ£ â€“ Password Encode Karna

```java
createdUser.setPassword(passwordEncoder.encode(user.getPassword()));
```

Very Important ğŸ”¥

Plain password kabhi store nahi karna.

---

## Step 4ï¸âƒ£ â€“ Save User

```java
User savedUser= userRepository.save(createdUser);
```

Ab user DB me save ho gaya.

---

## Step 5ï¸âƒ£ â€“ Create Cart

```java
Cart cart= new Cart();
cart.setCustomer(savedUser);
cartRepository.save(cart);
```

Har user ka apna cart hoga.

---

## Step 6ï¸âƒ£ â€“ Authentication Object Banana

```java
Authentication authentication=
    new UsernamePasswordAuthenticationToken(user.getEmail(), user.getPassword());
```

Yaha dikkat wali cheez hai âš ï¸

Ye sirf authentication object bana raha hai,
lekin isme authorities nahi hai.

Normally signup me authenticate method call karna chahiye tha (jaise signin me kiya).

But tutorial me simple approach use hua hai.

---

## Step 7ï¸âƒ£ â€“ SecurityContext Me Set Karna

```java
SecurityContextHolder.getContext().setAuthentication(authentication);
```

Spring ko bataya ja raha hai:
ğŸ‘‰ "Ab ye user logged in hai."

---

## Step 8ï¸âƒ£ â€“ JWT Generate Karna

```java
String jwt= jwtProvider.generateToken(authentication);
```

JWT token generate ho gaya.

Ye token future requests me use hoga.

---

## Step 9ï¸âƒ£ â€“ Response Return

```java
authResponse.setJwt(jwt);
authResponse.setMessage("Registration success");
authResponse.setRole(savedUser.getRole());
```

Client ko:

* JWT
* Role
* Message

return kar diya.

---

# ğŸ”µ SIGNIN FLOW (`/auth/signin`)

Yaha proper authentication ho raha hai.

---

## Step 1ï¸âƒ£ â€“ Email & Password Get

```java
String username= req.getEmail();
String password= req.getPassword();
```

---

## Step 2ï¸âƒ£ â€“ Authenticate Method Call

```java
Authentication authentication= authenticate(username,password);
```

Ab important part ğŸ‘‡

---

# ğŸ” authenticate() Method Explained

```java
UserDetails userDetails=
    customerUserDetailsService.loadUserByUsername(username);
```

Ye DB se user ko fetch karta hai.

Agar user nahi mila:

```java
throw new BadCredentialsException("Invalid Username");
```

---

## Password Check

```java
if(!passwordEncoder.matches(password,userDetails.getPassword()))
```

Ye compare karta hai:

ğŸ‘‰ Entered password
vs
ğŸ‘‰ Encoded DB password

Agar match nahi:

```java
throw new BadCredentialsException("Invalid Password");
```

---

## Authentication Object Return

```java
return new UsernamePasswordAuthenticationToken(
    userDetails,
    null,
    userDetails.getAuthorities()
);
```

Yaha difference dekho:

Signup me:

```
(email,password)
```

Signin me:

```
(userDetails, null, authorities)
```

Signin wala correct approach hai âœ…

---

# ğŸŸ¡ Authorities Ka Role

```java
Collection<?extends GrantedAuthority> authorities
```

Ye batata hai:
ğŸ‘‰ User ka role kya hai (ROLE_USER / ROLE_ADMIN)

---

# ğŸ”¥ JWT Kyu Generate Kar Rahe?

JWT future requests me use hoga:

Example:

```
GET /api/restaurants
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5...
```

Spring Security verify karega token valid hai ya nahi.

---

# ğŸ¯ Simple Flow Diagram

### Signup

User â†’ Controller â†’ Encode password â†’ Save â†’ Create Cart â†’ Generate JWT â†’ Return

### Signin

User â†’ Authenticate â†’ Password match â†’ Generate JWT â†’ Return

---

# âš ï¸ Important Observations (Improvement)

1ï¸âƒ£ Signup me proper authentication nahi ho raha
Better hoga agar:

```
authenticate(user.getEmail(), user.getPassword());
```

2ï¸âƒ£ `/signin` me message wrong hai:

```java
authResponse.setMessage("Registration success");
```

Yaha "Login success" hona chahiye.

---

# ğŸ§  Tumhe Kya Clear Hona Chahiye

* Authentication kya hai?
* PasswordEncoder kyu?
* JWT ka role kya?
* SecurityContext kya karta hai?
* UserDetailsService kyu use hota hai?

---

